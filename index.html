<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Joshua's Blog — a modern Y2K-inspired home for blogs, poems, and music streaming." />
  <meta name="theme-color" content="#0d5c3e" />
  <title>Joshua's Room</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="icon" href="logo.svg" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="ambient" aria-hidden="true"></div>

  <header class="shell hero">
    <button type="button" id="top-signout" class="btn btn-glass top-signout" hidden>Reader View</button>
    <p class="chip" id="mode-chip">READER VIEW</p>
    <img class="brand-logo" src="logo.png" alt="Joshua's Blog logo" />
    <h1>Joshua's Blog</h1>
    <p class="hero-copy">A sleek digital sanctuary for blogs, poems, and music. Built for storytelling, mood, and late-night streaming sessions.</p>
    <div class="hero-actions">
      <a href="#admin" class="btn btn-primary">Log In as Admin</a>
      <a href="#feed" class="btn btn-glass">Explore the Feed</a>
    </div>
  </header>

  <main class="layout">
    <section class="shell panel" id="admin">
      <div class="panel-head">
        <h2>Admin Login</h2>
        <p id="admin-status" class="admin-status">Reader mode. Sign in to manage posts.</p>
      </div>

      <div class="admin-controls">
        <div class="password-row">
          <input type="password" id="admin-password" placeholder="Enter your admin password" />
          <button type="button" class="btn btn-glass password-toggle" id="toggle-password">Show</button>
        </div>

        <button type="button" class="btn btn-primary" id="sign-in-admin">Sign In</button>
        <button type="button" class="btn btn-glass" id="forgot-password">Forgot Password?</button>

        <div id="password-setup" class="password-setup">
          <label class="hint-label" for="admin-hint">
            Password hint (shown in forgot password)
            <input type="text" id="admin-hint" placeholder="e.g., favorite album + year" maxlength="80" />
          </label>
          <button type="button" class="btn btn-glass" id="set-password">Set Password</button>
        </div>
      </div>
    </section>

    <section class="shell panel" id="compose" hidden>
      <div class="panel-head">
        <h2>Drop Something Beautiful</h2>
        <p>Publish in seconds. New posts are saved in your browser automatically.</p>
      </div>

      <form id="post-form" class="composer">
        <label>
          Content Type
          <select name="type" required>
            <option value="blog">Blog</option>
            <option value="poem">Poem</option>
            <option value="music">Music</option>
          </select>
        </label>

        <label>
          Title
          <input type="text" name="title" placeholder="Neon Rain Over Lagos" required maxlength="90" />
        </label>

        <label>
          Description / Body
          <textarea name="body" rows="6" placeholder="Write your post, poem, or lyrics notes..." required></textarea>
        </label>

        <label>
          Media URL (optional for blogs/poems, audio URL for music)
          <input type="url" name="media" placeholder="https://..." />
          <small class="field-help">For music posts: direct .mp3/.wav links stream in-page. SoundCloud/BandLab links open as external links.</small>
        </label>

        <label>
          Cover Image URL (optional)
          <input type="url" name="image" placeholder="https://..." />
        </label>

        <button type="submit" class="btn btn-primary">Publish to Blog</button>
      </form>
    </section>

    <section class="shell panel" id="feed">
      <div class="panel-head feed-head">
        <h2>Chronicle Feed</h2>
        <div class="pill-group" id="filters">
          <button class="pill active" data-filter="all">All</button>
          <button class="pill" data-filter="blog">Blogs</button>
          <button class="pill" data-filter="poem">Poems</button>
          <button class="pill" data-filter="music">Music</button>
        </div>
      </div>

      <div id="posts" class="post-grid"></div>
    </section>
  </main>

  <div class="modal-backdrop" id="delete-modal" hidden>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="delete-title">
      <h3 id="delete-title">Delete this entry?</h3>
      <p>This action is permanent. Once deleted, this entry cannot be recovered.</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-glass" id="cancel-delete">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirm-delete">Delete Entry</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="hint-modal" hidden>
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="hint-title">
      <h3 id="hint-title">Password Hint</h3>
      <p id="hint-content">No hint has been set yet.</p>
      <div class="modal-actions">
        <button type="button" class="btn btn-glass" id="close-hint">Close</button>
      </div>
    </div>
  </div>

  <template id="post-template">
    <article class="post-card">
      <button type="button" class="post-delete" aria-label="Delete entry">
        <span aria-hidden="true">×</span>
        <span class="delete-tip">Delete entry</span>
      </button>
      <div class="post-meta">
        <span class="post-type"></span>
        <time class="post-time"></time>
      </div>
      <h3 class="post-title"></h3>
      <img class="post-image" alt="Post cover image" loading="lazy" />
      <p class="post-body"></p>
      <a class="post-link" target="_blank" rel="noreferrer noopener"></a>
      <audio class="post-audio" controls></audio>
    </article>
  </template>

  <script>
    const STORAGE_KEY = 'joshua-blog-posts-v1';
    const ADMIN_PASSWORD_KEY = 'joshua-blog-admin-password';
    const ADMIN_UNLOCKED_KEY = 'joshua-blog-admin-unlocked';
    const ADMIN_HINT_KEY = 'joshua-blog-admin-hint';

    const starterPosts = [
      {
        id: crypto.randomUUID(),
        type: 'blog',
        title: 'Future Nostalgia: Why Y2K Design Still Hits',
        body: 'The chrome, the glow, the dreamy gradients — Y2K wasn\'t just style. It was optimism rendered in pixels. This Almanac is my tribute to that energy.',
        media: '',
        image: 'https://images.unsplash.com/photo-1516117172878-fd2c41f4a759?auto=format&fit=crop&w=1400&q=80',
        createdAt: new Date().toISOString()
      },
      {
        id: crypto.randomUUID(),
        type: 'poem',
        title: 'Green Glass Nights',
        body: 'On screens of emerald light\\nI leave my pulse in every line\\nA city hums, a playlist spins\\nTomorrow starts where memory ends.',
        media: '',
        image: 'https://images.unsplash.com/photo-1455390582262-044cdead277a?auto=format&fit=crop&w=1400&q=80',
        createdAt: new Date(Date.now() - 3600 * 1000 * 7).toISOString()
      },
      {
        id: crypto.randomUUID(),
        type: 'music',
        title: 'Midnight Circuit (Demo)',
        body: 'A dreamy synth sketch with warm bass and floating pads.',
        media: 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
        image: 'https://images.unsplash.com/photo-1470225620780-dba8ba36b745?auto=format&fit=crop&w=1400&q=80',
        createdAt: new Date(Date.now() - 3600 * 1000 * 20).toISOString()
      }
    ];

    const postForm = document.querySelector('#post-form');
    const composeSection = document.querySelector('#compose');
    const adminSection = document.querySelector('#admin');
    const topSignoutButton = document.querySelector('#top-signout');
    const modeChip = document.querySelector('#mode-chip');
    const postsContainer = document.querySelector('#posts');
    const postTemplate = document.querySelector('#post-template');
    const filterButtons = document.querySelectorAll('#filters .pill');
    const adminStatus = document.querySelector('#admin-status');
    const adminPasswordInput = document.querySelector('#admin-password');
    const signInAdminButton = document.querySelector('#sign-in-admin');
    const setPasswordButton = document.querySelector('#set-password');
    const forgotPasswordButton = document.querySelector('#forgot-password');
    const passwordSetup = document.querySelector('#password-setup');
    const togglePasswordButton = document.querySelector('#toggle-password');
    const adminHintInput = document.querySelector('#admin-hint');
    const deleteModal = document.querySelector('#delete-modal');
    const cancelDeleteButton = document.querySelector('#cancel-delete');
    const confirmDeleteButton = document.querySelector('#confirm-delete');
    const hintModal = document.querySelector('#hint-modal');
    const hintContent = document.querySelector('#hint-content');
    const closeHintButton = document.querySelector('#close-hint');

    let filter = 'all';
    let posts = loadPosts();
    let isAdminUnlocked = sessionStorage.getItem(ADMIN_UNLOCKED_KEY) === 'true';
    let pendingDeleteId = null;

    syncAdminUi();
    renderPosts();

    postForm.addEventListener('submit', (event) => {
      event.preventDefault();
      if (!isAdminUnlocked) {
        return;
      }

      const formData = new FormData(postForm);
      const post = {
        id: crypto.randomUUID(),
        type: formData.get('type'),
        title: formData.get('title').trim(),
        body: formData.get('body').trim(),
        media: formData.get('media').trim(),
        image: formData.get('image').trim(),
        createdAt: new Date().toISOString()
      };

      posts.unshift(post);
      savePosts(posts);
      renderPosts();
      postForm.reset();
    });

    filterButtons.forEach((button) => {
      button.addEventListener('click', () => {
        filter = button.dataset.filter;
        filterButtons.forEach((item) => item.classList.remove('active'));
        button.classList.add('active');
        renderPosts();
      });
    });

    togglePasswordButton.addEventListener('click', () => {
      const showPassword = adminPasswordInput.type === 'password';
      adminPasswordInput.type = showPassword ? 'text' : 'password';
      togglePasswordButton.textContent = showPassword ? 'Hide' : 'Show';
    });

    signInAdminButton.addEventListener('click', () => {
      const storedPassword = localStorage.getItem(ADMIN_PASSWORD_KEY);
      const enteredPassword = adminPasswordInput.value.trim();

      if (!storedPassword) {
        alert('No password is set yet. Set one first.');
        return;
      }

      if (enteredPassword !== storedPassword) {
        alert('Wrong password.');
        return;
      }

      isAdminUnlocked = true;
      sessionStorage.setItem(ADMIN_UNLOCKED_KEY, 'true');
      adminPasswordInput.value = '';
      adminPasswordInput.type = 'password';
      togglePasswordButton.textContent = 'Show';
      syncAdminUi();
      renderPosts();
      composeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    setPasswordButton.addEventListener('click', () => {
      const nextPassword = adminPasswordInput.value.trim();
      if (!nextPassword) {
        alert('Enter a password to set.');
        return;
      }

      localStorage.setItem(ADMIN_PASSWORD_KEY, nextPassword);
      localStorage.setItem(ADMIN_HINT_KEY, adminHintInput.value.trim());
      isAdminUnlocked = true;
      sessionStorage.setItem(ADMIN_UNLOCKED_KEY, 'true');
      adminPasswordInput.value = '';
      adminHintInput.value = '';
      adminPasswordInput.type = 'password';
      togglePasswordButton.textContent = 'Show';
      syncAdminUi();
      renderPosts();
      composeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    forgotPasswordButton.addEventListener('click', () => {
      const hint = localStorage.getItem(ADMIN_HINT_KEY);
      hintContent.textContent = hint ? `Hint: ${hint}` : 'No hint has been set yet.';
      hintModal.hidden = false;
    });

    closeHintButton.addEventListener('click', () => {
      hintModal.hidden = true;
    });

    topSignoutButton.addEventListener('click', () => {
      isAdminUnlocked = false;
      sessionStorage.removeItem(ADMIN_UNLOCKED_KEY);
      adminPasswordInput.value = '';
      adminHintInput.value = '';
      adminPasswordInput.type = 'password';
      togglePasswordButton.textContent = 'Show';
      syncAdminUi();
      renderPosts();
      document.querySelector('#feed').scrollIntoView({ behavior: 'smooth', block: 'start' });
    });

    postsContainer.addEventListener('click', (event) => {
      const deleteButton = event.target.closest('.post-delete');
      if (!deleteButton || !isAdminUnlocked) {
        return;
      }

      pendingDeleteId = deleteButton.dataset.postId;
      deleteModal.hidden = false;
    });

    cancelDeleteButton.addEventListener('click', () => {
      pendingDeleteId = null;
      deleteModal.hidden = true;
    });

    confirmDeleteButton.addEventListener('click', () => {
      if (!pendingDeleteId) {
        deleteModal.hidden = true;
        return;
      }

      posts = posts.filter((post) => post.id !== pendingDeleteId);
      savePosts(posts);
      pendingDeleteId = null;
      deleteModal.hidden = true;
      renderPosts();
    });

    [hintModal, deleteModal].forEach((modal) => {
      modal.addEventListener('click', (event) => {
        if (event.target === modal) {
          modal.hidden = true;
          if (modal === deleteModal) {
            pendingDeleteId = null;
          }
        }
      });
    });

    function loadPosts() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(starterPosts));
          return starterPosts;
        }
        return JSON.parse(raw);
      } catch {
        return starterPosts;
      }
    }

    function savePosts(nextPosts) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(nextPosts));
    }

    function renderPosts() {
      postsContainer.innerHTML = '';
      const filtered = posts.filter((post) => filter === 'all' || post.type === filter);

      if (!filtered.length) {
        postsContainer.innerHTML = '<p class="empty-state">Nothing here yet — publish the first piece in this category.</p>';
        return;
      }

      filtered.forEach((post) => {
        const node = postTemplate.content.cloneNode(true);
        node.querySelector('.post-type').textContent = post.type.toUpperCase();
        node.querySelector('.post-time').textContent = formatDate(post.createdAt);
        node.querySelector('.post-title').textContent = post.title;
        node.querySelector('.post-body').textContent = post.body;

        const image = node.querySelector('.post-image');
        const link = node.querySelector('.post-link');
        const audio = node.querySelector('.post-audio');
        const deleteButton = node.querySelector('.post-delete');

        deleteButton.dataset.postId = post.id;
        deleteButton.hidden = !isAdminUnlocked;

        if (post.image) {
          image.src = post.image;
        } else {
          image.remove();
        }

        if (post.media) {
          if (post.type === 'music' && isDirectAudioUrl(post.media)) {
            audio.src = post.media;
            link.remove();
          } else {
            link.textContent = post.type === 'music' ? 'Open song page ↗' : 'Open media ↗';
            link.href = post.media;
            audio.remove();
          }
        } else {
          link.remove();
          audio.remove();
        }

        postsContainer.append(node);
      });
    }

    function syncAdminUi() {
      const hasPassword = Boolean(localStorage.getItem(ADMIN_PASSWORD_KEY));

      composeSection.hidden = !isAdminUnlocked;
      adminSection.hidden = isAdminUnlocked;
      topSignoutButton.hidden = !isAdminUnlocked;
      passwordSetup.hidden = hasPassword;
      signInAdminButton.disabled = !hasPassword;
      forgotPasswordButton.disabled = !hasPassword;

      document.body.classList.toggle('admin-mode', isAdminUnlocked);
      modeChip.textContent = isAdminUnlocked ? 'ADMIN ACCESS' : 'READER VIEW';

      if (!hasPassword) {
        adminStatus.textContent = 'Set your password once, then use Sign In going forward.';
      } else if (isAdminUnlocked) {
        adminStatus.textContent = 'Admin mode active.';
      } else {
        adminStatus.textContent = 'Reader mode. Sign in to manage posts.';
      }
    }

    function isDirectAudioUrl(url) {
      return /\.(mp3|wav|ogg|m4a)(\?.*)?$/i.test(url);
    }

    function formatDate(isoDate) {
      return new Intl.DateTimeFormat('en', {
        month: 'short',
        day: 'numeric',
        hour: 'numeric',
        minute: '2-digit'
      }).format(new Date(isoDate));
    }
  </script>
</body>
</html>



